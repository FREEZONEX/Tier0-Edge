name: Gitea Actions Build
run-name: ${{ gitea.actor }} is building Frontend ğŸš€
on: [push]

jobs:
  Build-And-Package:
    runs-on: ubuntu-latest
    steps:
      - name: Basic Info
        run: |
          echo "ğŸ‰ Triggered by ${{ gitea.event_name }} event."
          echo "ğŸ” Branch: ${{ gitea.ref }}, Repo: ${{ gitea.repository }}."

      - name: Check out repository code
        uses: actions/checkout@v4

      - name: Build Docker image
        run: |
          # æ„å»ºé•œåƒï¼Œä½¿ç”¨ä»“åº“åä½œä¸ºé•œåƒå
          docker build -t ${{ gitea.repository }}:latest .
          # å¦‚æœéœ€è¦æ¨é€åˆ°æœ¬åœ° Registry æˆ–æ‰“ Tagï¼Œåœ¨æ­¤å¤„æ·»åŠ é€»è¾‘
          echo "Docker image built: ${{ gitea.repository }}:latest"

      - name: Clean up
        if: always() # æ— è®ºæ„å»ºæˆåŠŸä¸å¦éƒ½å°è¯•æ¸…ç†
        run: |
          echo "ğŸ§¹ Cleaning up Docker resources..."
          docker builder prune --all --force
          # æ³¨æ„ï¼šåœ¨ç”Ÿäº§Runnerä¸Šæ…ç”¨ prune -aï¼Œå¯èƒ½ä¼šåˆ é™¤å…¶ä»–ç¼“å­˜
          docker image prune -f 
          # ç§»é™¤æ‚¬ç©ºé•œåƒ
          docker rmi $(docker images --filter "dangling=true" -q) || true

      - run: echo "ğŸ Job status: ${{ job.status }}."

